require(["gitbook","jquery"],function(o,s){var a,r,i,e,l,c,n=15,u=500,h=void 0!==history.pushState,t=s("body");function p(e){t.addClass("with-search"),t.addClass("search-loading"),o.search.query(e,0,n).then(function(e){var n;e=e,a.addClass("open"),n=0==e.count,a.toggleClass("no-results",n),i.empty(),l.text(e.count),c.text(e.query),e.results.forEach(function(e){var n=s("<li>",{class:"search-results-item"}),t=s("<h3>"),a=s("<a>",{href:o.state.basePath+"/"+e.url,text:e.title}),e=e.body.trim(),e=(e.length>u&&(e=e.slice(0,u).trim()+"..."),s("<p>").html(e));a.appendTo(t),t.appendTo(n),e.appendTo(n),n.appendTo(i)})}).always(function(){t.removeClass("search-loading")})}function d(){t.removeClass("with-search"),a.removeClass("open")}function f(){var e=function(e){var n=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");e=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i").exec(n);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}("q");e&&0<e.length&&(r.val(e),p(e))}function v(){function n(){var e=r.val();0==e.length?d():p(e)}r=s("#book-search-input input"),a=s("#book-search-results"),i=a.find(".search-results-list"),e=a.find(".search-results-title"),l=e.find(".search-results-count"),c=e.find(".search-query");var t=!1;r.on("propertychange",function(e){"value"==e.originalEvent.propertyName&&n()}),r.on("input",function(e){t||(s(this).unbind("propertychange"),t=!0),n()}),r.on("blur",function(e){var n,t,a,o,r;h&&(n="q",t=s(this).val(),t=encodeURIComponent(t),o=window.location.href,r=(r=new RegExp("([?&])"+n+"=.*?(&|#|$)(.*)","gi")).test(o)?null!=t?o.replace(r,"$1"+n+"="+t+"$2$3"):(o=(a=o.split("#"))[0].replace(r,"$1$3").replace(/(&|\?)$/,""),void 0!==a[1]&&null!==a[1]&&(o+="#"+a[1]),o):(null!=t&&(r=-1!==o.indexOf("?")?"&":"?",o=(a=o.split("#"))[0]+r+n+"="+t,void 0!==a[1])&&null!==a[1]&&(o+="#"+a[1]),o),history.pushState({path:r},null,r))})}o.events.on("page.change",function(){v(),d(),o.search.isInitialized()&&f()}),o.events.on("search.ready",function(){v(),f()})});